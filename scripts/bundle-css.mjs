
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
// Depending on where this script is run, usually from root.
// We'll assume it's run from root, so src/ is ./src

const srcDir = path.join(process.cwd(), 'src');
const stylesDir = path.join(srcDir, 'styles');
const outputFile = path.join(srcDir, 'styles.css');

const files = [
    'font.css',
    'variables.css',
    'base.css',
    'timeline.css',
    'scenes.css',
    'grid.css',
    'indicators.css',
    'chronologue.css',
    'modals.css',
    'pulse.css',
    'settings.css',
    'drag.css'
];

async function bundle() {
    console.log('Bundling CSS...');
    let bundleContent = '';

    // Add a header
    bundleContent += '/* \n';
    bundleContent += ' * RADIAL TIMELINE STYLES\n';
    bundleContent += ' * Auto-generated from src/styles/*.css\n';
    bundleContent += ' * Do not edit this file directly. Edit the files in src/styles/ instead.\n';
    bundleContent += ' */\n\n';

    for (const file of files) {
        const filePath = path.join(stylesDir, file);
        if (fs.existsSync(filePath)) {
            const content = fs.readFileSync(filePath, 'utf-8');
            bundleContent += `/* --- ${file} --- */\n`;
            bundleContent += content;
            bundleContent += '\n\n';
        } else {
            console.warn(`Warning: ${file} not found in ${stylesDir}`);
        }
    }

    fs.writeFileSync(outputFile, bundleContent);
    console.log(`CSS bundled to ${outputFile} (${bundleContent.length} bytes)`);
}

// Allow direct execution
if (process.argv[1] === fileURLToPath(import.meta.url)) {
    bundle().catch(err => {
        console.error('CSS Bundling failed:', err);
        process.exit(1);
    });
}

export { bundle as bundleCSS };
