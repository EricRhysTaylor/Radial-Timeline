<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>APR Branding Test</title>
    <style>
        body { font-family: sans-serif; background: #0d0d0f; color: #fff; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
        .test-case { text-align: center; margin: 10px; }
        svg { border: 1px solid #333; background: #1a1a1c; }
    </style>
</head>
<body>
    <h1>APR Branding Test</h1>
    <div class="container" id="output"></div>

    <script>
        function renderBranding(bookTitle, authorName, radius) {
            const separator = ' ~ ';
            const bookTitleUpper = bookTitle.toUpperCase();
            const authorNameUpper = authorName ? authorName.toUpperCase() : '';
            const circumference = 2 * Math.PI * radius;
            
            // 1. Create unit pattern
            // Note: We need a trailing separator to ensure spacing between the last author and first title
            const unitText = authorNameUpper 
                ? `${bookTitleUpper}${separator}${authorNameUpper}${separator}`
                : `${bookTitleUpper}${separator}`;
                
            // 2. Measure unit length (approximate for this test, or use canvas)
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const fontSize = 14; 
            const fontFamily = 'Inter, sans-serif';
            ctx.font = `${fontSize}px ${fontFamily}`;
            const unitWidth = ctx.measureText(unitText).width;
            
            // 3. Calculate optimal repeats
            // We want the text to fill the circumference.
            // visual_repeats = circumference / unitWidth
            // We round to nearest integer to have "whole" units
            let repeats = Math.round(circumference / unitWidth);
            if (repeats < 1) repeats = 1;
            
            // 4. Construct content
            let fullText = '';
            for (let i = 0; i < repeats; i++) {
                fullText += unitText;
            }
            
            // 5. Build SVG
            const size = radius * 2 + 40;
            const center = size / 2;
            const pathId = `path-${Math.random().toString(36).substr(2, 9)}`;
            
            // Path definition: M (start) A (arc) ...
            // Circle starting at top (0, -r) relative to center, needs to be absolute
            // Move to (center, center - radius)
            // Arc to (center, center + radius) and back
            
            /* 
               M cx, cy-r 
               A r,r 0 1,1 cx, cy+r
               A r,r 0 1,1 cx, cy-r
            */
            const d = `M ${center},${center - radius} A ${radius},${radius} 0 1,1 ${center},${center + radius} A ${radius},${radius} 0 1,1 ${center},${center - radius}`;

            // Create TSPANS for coloring
            // In the real code we map segments to tspans. Here we simulate it.
            let textContent = '';
            for (let i = 0; i < repeats; i++) {
                 textContent += `<tspan fill="#6FB971">${bookTitleUpper}</tspan><tspan fill="#6FB971">${separator}</tspan>`;
                 if (authorNameUpper) {
                     textContent += `<tspan fill="#fff">${authorNameUpper}</tspan><tspan fill="#6FB971">${separator}</tspan>`;
                 }
            }

            return `
                <svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
                     <defs>
                        <path id="${pathId}" d="${d}" />
                     </defs>
                     <circle cx="${center}" cy="${center}" r="${radius}" fill="none" stroke="#333" stroke-width="1" />
                     <text font-family="${fontFamily}" font-size="${fontSize}" dy="-2">
                        <textPath href="#${pathId}" textLength="${circumference}" lengthAdjust="spacing">
                            ${textContent}
                        </textPath>
                     </text>
                     <text x="10" y="20" fill="#aaa" font-size="10">R=${radius}, UnitW=${unitWidth.toFixed(0)}, Circ=${circumference.toFixed(0)}, N=${repeats}</text>
                </svg>
            `;
        }

        const tests = [
            { title: "Working Title", author: "Author Name", radius: 140 }, // Classic
            { title: "Short", author: "Me", radius: 140 }, // Should repeat many times
            { title: "A Very Long Title Indeed That Takes Up Space", author: "Prolix Writer", radius: 80 }, // Small radius, long text
            { title: "Just Title", author: "", radius: 100 }, // No author
        ];

        const container = document.getElementById('output');
        tests.forEach(t => {
            const div = document.createElement('div');
            div.className = 'test-case';
            div.innerHTML = `<h3>${t.title}</h3>` + renderBranding(t.title, t.author, t.radius);
            container.appendChild(div);
        });
    </script>
</body>
</html>
